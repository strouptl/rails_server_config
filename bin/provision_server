#!/bin/bash

# Add sources
## RVM (https://rvm.io/rvm/install#ubuntu)
sudo apt-get install software-properties-common -y
gpg --keyserver hkp://pool.sks-keyservers.net --recv-keys 409B6B1796C275462A1703113804BB82D39DC0E3 7D2BAF1CF37B13E2069D6956105BD0E739499BDB
sudo apt-add-repository -y ppa:rael-gc/rvm

# Install Packages

## PostgreSQL Client
sudo apt install postgresql-client-14 -y

## Nginx
sudo apt install nginx -y

## Redis
sudo apt install redis -y

## Logrotate
sudo apt install logrotate -y

## RVM (https://rvm.io/rvm/install#ubuntu)
sudo apt-get install rvm -y
sudo apt-get install libncurses5-dev, libgmp-dev, libssl-dev -y
sudo usermod -a -G rvm $USER

## NodeJS (for JS runtime)
sudo apt-get install nodejs -y

## Yarn
sudo apt install yarnpkg -y

## Ruby Gem dependencies (PostgreSQL and ActiveStorage)
sudo apt install libpq-dev -y
sudo apt install imagemagick libvips -y

# Prepare Capistrano Directory
sudo mkdir /var/www/rails
sudo chown -R ubuntu:ubuntu /var/www/rails
mkdir /var/www/rails/shared

# Enable services
sudo systemctl enable rails
sudo systemctl enable sidekiq

# Reload services (for logrotate)
sudo systemctl daemon-reload

# Install AWS Cloudwatch
./bin/install_aws_cloudwatch
